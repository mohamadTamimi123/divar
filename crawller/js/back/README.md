# 🏠 Divar Property Crawler

کراولر هوشمند برای استخراج آگهی‌های املاک از دیوار برای شهرهای تهران و کرج

## 🎯 ویژگی‌ها

- ✅ کراول آگهی‌های فروش و اجاره
- ✅ پشتیبانی از شهرهای تهران و کرج
- ✅ استخراج جزئیات کامل آگهی‌ها
- ✅ ذخیره تصاویر و اطلاعات مکانی
- ✅ مدیریت خطا و retry
- ✅ گزارش‌گیری کامل
- ✅ تنظیمات قابل تغییر

## 📋 پیش‌نیازها

### نرم‌افزارهای مورد نیاز:
- Node.js (نسخه 14 یا بالاتر)
- Google Chrome
- npm یا yarn

### نصب وابستگی‌ها:
```bash
npm install
```

## 🚀 راه‌اندازی

### 1. تنظیمات اولیه
فایل `config.js` را بررسی و تنظیم کنید:

```javascript
module.exports = {
    maxAdsPerType: 50,           // تعداد آگهی‌ها
    delayBetweenAds: 2000,       // تاخیر بین آگهی‌ها
    headless: false,             // حالت headless
    executablePath: '/usr/bin/google-chrome' // مسیر Chrome
};
```

### 2. اجرای کراولر
```bash
node divar_crawler.js
```

## 📊 خروجی

کراولر فایل‌های زیر را تولید می‌کند:

### فایل‌های جداگانه:
- `tehran_sale_[timestamp].json` - آگهی‌های فروش تهران
- `tehran_rent_[timestamp].json` - آگهی‌های اجاره تهران
- `karaj_sale_[timestamp].json` - آگهی‌های فروش کرج
- `karaj_rent_[timestamp].json` - آگهی‌های اجاره کرج

### فایل‌های ترکیبی:
- `divar_combined_[timestamp].json` - تمام نتایج
- `summary_[timestamp].json` - خلاصه آماری

## 📁 ساختار داده

### آگهی فروش:
```json
{
    "title": "عنوان آگهی",
    "metraj": "متراژ",
    "salSakht": "سال ساخت",
    "otagh": "تعداد اتاق",
    "gheymatKol": "قیمت کل",
    "gheymatHarMetr": "قیمت هر متر",
    "tabaghe": "طبقه",
    "parking": "پارکینگ",
    "asansor": "آسانسور",
    "anbari": "انباری",
    "tozihat": "توضیحات",
    "location": "موقعیت",
    "imageLinks": ["لینک تصاویر"],
    "city": "شهر",
    "adType": "نوع آگهی",
    "url": "لینک آگهی",
    "scrapedAt": "تاریخ استخراج"
}
```

### آگهی اجاره:
```json
{
    "title": "عنوان آگهی",
    "metraj": "متراژ",
    "salSakht": "سال ساخت",
    "otagh": "تعداد اتاق",
    "vadie": "ودیعه",
    "ejare": "اجاره ماهانه",
    "tabaghe": "طبقه",
    "parking": "پارکینگ",
    "asansor": "آسانسور",
    "anbari": "انباری",
    "tozihat": "توضیحات",
    "location": "موقعیت",
    "imageLinks": ["لینک تصاویر"],
    "city": "شهر",
    "adType": "نوع آگهی",
    "url": "لینک آگهی",
    "scrapedAt": "تاریخ استخراج"
}
```

## ⚙️ تنظیمات

### تنظیمات اصلی:
- `maxAdsPerType`: حداکثر تعداد آگهی برای هر نوع (پیش‌فرض: 50)
- `delayBetweenAds`: تاخیر بین پردازش آگهی‌ها (پیش‌فرض: 2000ms)
- `headless`: اجرا در حالت headless (پیش‌فرض: false)
- `executablePath`: مسیر اجرایی Chrome

### تنظیمات زمانی:
- `pageLoadTimeout`: تایم‌اوت بارگذاری صفحه (پیش‌فرض: 30000ms)
- `elementWaitTimeout`: تایم‌اوت انتظار برای عناصر (پیش‌فرض: 15000ms)
- `adProcessTimeout`: تایم‌اوت پردازش آگهی (پیش‌فرض: 20000ms)

## 🔧 عیب‌یابی

### مشکلات رایج:

1. **خطای Chrome executable:**
   ```bash
   # مسیر Chrome را در config.js تنظیم کنید
   executablePath: '/usr/bin/google-chrome'
   ```

2. **خطای timeout:**
   - تایم‌اوت‌ها را در config.js افزایش دهید
   - سرعت اینترنت را بررسی کنید

3. **خطای element not found:**
   - ساختار صفحه دیوار تغییر کرده
   - selector ها را بررسی کنید

### لاگ‌ها:
کراولر لاگ‌های کامل تولید می‌کند:
- ✅ موفقیت‌ها
- ⚠️ هشدارها
- ❌ خطاها

## 📈 آمار و گزارش

### خلاصه آماری:
```json
{
    "timestamp": "2024-01-01T12:00:00.000Z",
    "totalAds": {
        "sale": {
            "tehran": 45,
            "karaj": 38
        },
        "rent": {
            "tehran": 42,
            "karaj": 35
        }
    },
    "config": {...}
}
```

## 🤝 مشارکت

برای مشارکت در توسعه:
1. Fork کنید
2. Branch جدید ایجاد کنید
3. تغییرات را commit کنید
4. Pull request ارسال کنید

## 📄 لایسنس

این پروژه تحت لایسنس MIT منتشر شده است.

## ⚠️ نکات مهم

- از کراولر به صورت مسئولانه استفاده کنید
- به robots.txt سایت احترام بگذارید
- تاخیرهای مناسب بین درخواست‌ها رعایت کنید
- از داده‌های استخراج شده فقط برای اهداف قانونی استفاده کنید

## 📞 پشتیبانی

برای گزارش مشکلات یا پیشنهادات:
- Issue در GitHub ایجاد کنید
- مستندات را بررسی کنید
- کد را debug کنید 